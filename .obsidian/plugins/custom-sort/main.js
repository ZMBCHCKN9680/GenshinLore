/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Q=Object.defineProperty;var Tt=Object.getOwnPropertyDescriptor;var Rt=Object.getOwnPropertyNames;var Et=Object.prototype.hasOwnProperty;var Pt=(t,e)=>{for(var r in e)Q(t,r,{get:e[r],enumerable:!0})},Nt=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Rt(e))!Et.call(t,i)&&i!==r&&Q(t,i,{get:()=>e[i],enumerable:!(n=Tt(e,i))||n.enumerable});return t};var Mt=t=>Nt(Q({},"__esModule",{value:!0}),t);var Gr={};Pt(Gr,{default:()=>J});module.exports=Mt(Gr);var h=require("obsidian");function Ce(t,e){let r=Object.keys(e).map(n=>Lt(t,n,e[n]));return r.length===1?r[0]:function(){r.forEach(n=>n())}}function Lt(t,e,r){let n=t[e],i=t.hasOwnProperty(e),o=r(n);return n&&Object.setPrototypeOf(o,n),Object.setPrototypeOf(l,o),t[e]=l,s;function l(...a){return o===n&&t[e]===l&&s(),o.apply(this,a)}function s(){t[e]===l&&(i?t[e]=n:delete t[e]),o!==n&&(o=n,Object.setPrototypeOf(l,n||Function))}}var re=require("obsidian");var ee="findStarredFile",vt="starred",Ie=t=>{var r;let e=(r=t==null?void 0:t.internalPlugins)==null?void 0:r.getPluginById(vt);if(e&&e.enabled&&e.instance){let n=e.instance;if(typeof(n==null?void 0:n[ee])=="function")return n}},Dt=t=>!!t.isRoot,_t=(t,e)=>t.children.some(r=>!Dt(r)&&e[ee]({path:r.path})),Oe=(t,e,r)=>e?!!r[ee]({path:t.path}):_t(t,r);var Te="getData",Ae="obsidian-icon-folder",Re=t=>{var r,n,i,o;let e=(n=(r=t==null?void 0:t.plugins)==null?void 0:r.plugins)==null?void 0:n[Ae];if(e&&e._loaded&&((o=(i=t==null?void 0:t.plugins)==null?void 0:i.enabledPlugins)!=null&&o.has(Ae))){let l=e;if(typeof(l==null?void 0:l[Te])=="function")return l}},Ee=(t,e)=>{var i;let r=e[Te](),n=r==null?void 0:r[t.path];return typeof n=="string"?n:typeof(n==null?void 0:n.iconName)=="string"&&(i=n==null?void 0:n.iconName)!=null?i:void 0};var G="sort-index-value";function y(t){return t!=null}function D(t){return(t==null?void 0:t.length)>0?t[t.length-1]:void 0}var A=new Intl.Collator(void 0,{usage:"sort",sensitivity:"base",numeric:!0}).compare,ie=new Intl.Collator(void 0,{usage:"sort",sensitivity:"base",numeric:!1}).compare,Pe=!0,Ne=!0,Me=!1,W=(t,e)=>{let r=e?ie:A;return(n,i)=>{if(t&&([n,i]=[i,n]),n.metadataFieldValue&&i.metadataFieldValue){let o=r(n.metadataFieldValue,i.metadataFieldValue);return o===0?r(n.sortString,i.sortString):o}return n.metadataFieldValue?t?1:-1:i.metadataFieldValue?t?-1:1:r(n.sortString,i.sortString)}},te={[1]:(t,e)=>A(t.sortString,e.sortString),[2]:(t,e)=>ie(t.sortString,e.sortString),[3]:(t,e)=>A(e.sortString,t.sortString),[4]:(t,e)=>ie(e.sortString,t.sortString),[5]:(t,e)=>t.isFolder&&e.isFolder?A(t.sortString,e.sortString):t.mtime-e.mtime,[6]:(t,e)=>t.mtime-e.mtime,[7]:(t,e)=>t.isFolder&&e.isFolder?A(t.sortString,e.sortString):e.mtime-t.mtime,[8]:(t,e)=>e.mtime-t.mtime,[9]:(t,e)=>t.isFolder&&e.isFolder?A(t.sortString,e.sortString):t.ctimeNewest-e.ctimeNewest,[10]:(t,e)=>t.ctimeNewest-e.ctimeNewest,[11]:(t,e)=>t.isFolder&&e.isFolder?A(t.sortString,e.sortString):e.ctimeOldest-t.ctimeOldest,[12]:(t,e)=>e.ctimeOldest-t.ctimeOldest,[13]:W(Me),[14]:W(Me,Pe),[15]:W(Ne),[16]:W(Ne,Pe),[17]:(t,e)=>A(t.sortString,e.sortString)};function Gt(t,e,r){var n,i;if(t.groupIdx!=null&&e.groupIdx!=null)if(t.groupIdx===e.groupIdx){let o=r.groups[t.groupIdx];return t.matchGroup!==void 0&&t.matchGroup===e.matchGroup&&o.secondaryOrder?te[(n=o.secondaryOrder)!=null?n:1](t,e):te[(i=o==null?void 0:o.order)!=null?i:1](t,e)}else return t.groupIdx-e.groupIdx;else return te[1](t,e)}var _e=t=>!!t.isRoot,Le=t=>t===13||t===15||t===14||t===16,we=0,ne=0,P=(t,e)=>{let r=t.regex.exec(e);if(r){let n=t.normalizerFn,i=r[1];return i?[!0,n?n(i):i,r[0]]:[!0,void 0,r[0]]}return[!1,void 0,void 0]},Wt=function(t,e,r){var F,L,v,Se,be,Fe;let n,i=!1,o,l,s=_e(t),a=!s,u=t,d=s?t.name:u.basename,f=e.priorityOrder?e.priorityOrder.length:e.groups.length;for(let b=0;b<f;b++){o=null,n=e.priorityOrder?e.priorityOrder[b]:b;let g=e.groups[n];if(g.foldersOnly&&a||g.filesOnly&&s)continue;let x=g.matchFilenameWithExt?t.name:d;switch(g.type){case 3:g.exactPrefix?x.startsWith(g.exactPrefix)&&(i=!0):[i,o]=P(g.regexPrefix,x);break;case 4:g.exactSuffix?x.endsWith(g.exactSuffix)&&(i=!0):[i,o]=P(g.regexSuffix,x);break;case 5:if(g.exactPrefix&&g.exactSuffix)x.length>=g.exactPrefix.length+g.exactSuffix.length&&x.startsWith(g.exactPrefix)&&x.endsWith(g.exactSuffix)&&(i=!0);else if(g.exactPrefix||g.exactSuffix){if(g.exactPrefix&&x.startsWith(g.exactPrefix)||g.exactSuffix&&x.endsWith(g.exactSuffix)){let S;[i,o,S]=P(g.exactPrefix?g.regexSuffix:g.regexPrefix,x),i&&S.length+((L=(F=g.exactPrefix)==null?void 0:F.length)!=null?L:0)+((Se=(v=g.exactSuffix)==null?void 0:v.length)!=null?Se:0)>x.length&&(i=!1,o=null)}}else{let[S,T,ye]=P(g.regexPrefix,x),[Ot,At,c]=P(g.regexSuffix,x);S&&Ot&&ye.length+c.length<=x.length&&(i=!0,o=T!=null?T:At)}break;case 2:g.exactText?x===g.exactText&&(i=!0):[i,o]=P(g.regexPrefix,x);break;case 6:if(g.withMetadataFieldName&&e._mCache){let S=a?t.path:`${t.path}/${t.name}.md`,T=(be=e._mCache.getCache(S))==null?void 0:be.frontmatter;(T==null?void 0:T.hasOwnProperty(g.withMetadataFieldName))&&(i=!0)}break;case 7:r!=null&&r.starredPluginInstance&&Oe(t,a,r.starredPluginInstance)&&(i=!0);break;case 8:if(r!=null&&r.iconFolderPluginInstance){let S=Ee(t,r.iconFolderPluginInstance);S&&(g.iconName?i=S===g.iconName:i=!0)}break;case 1:i=!0;break}if(i)break}let m=e.groups.length,p=i?n:m;if(i){let b=e.groups[p].combineWithIdx;b!==void 0&&(p=b)}if(i||(y(e.outsidersFilesGroupIdx)&&a?(p=e.outsidersFilesGroupIdx,i=!0):y(e.outsidersFoldersGroupIdx)&&s?(p=e.outsidersFoldersGroupIdx,i=!0):y(e.outsidersGroupIdx)&&(p=e.outsidersGroupIdx,i=!0)),i&&p!==void 0){let b=e.groups[p];if(Le(b==null?void 0:b.order)){let g=b.byMetadataField;if(g||Le(e.defaultOrder)&&(g=e.byMetadataField),g||(g=b.withMetadataFieldName),g||(g=G),g&&e._mCache){let x=a?t.path:`${t.path}/${t.name}.md`,S=(Fe=e._mCache.getCache(x))==null?void 0:Fe.frontmatter;l=S==null?void 0:S[g]}}}return{groupIdx:p,sortString:o?o+"//"+t.name:t.name,metadataFieldValue:l,matchGroup:o!=null?o:void 0,isFolder:s,folder:s?t:void 0,path:t.path,ctimeNewest:a?u.stat.ctime:ne,ctimeOldest:a?u.stat.ctime:ne,mtime:a?u.stat.mtime:we}},ve=new Set([6,8,10,12]),Vt=(t,e)=>ve.has(t!=null?t:17)||ve.has(e!=null?e:17),kt=(t,e)=>{let r=we,n=ne,i=e;return t.children.forEach(o=>{if(!_e(o)){let l=o;l.stat.mtime>r&&(r=l.stat.mtime),l.stat.ctime>n&&(n=l.stat.ctime),l.stat.ctime<i&&(i=l.stat.ctime)}}),[r,n,i]},$t=(t,e)=>{let r=Date.now();t.forEach(n=>{let i=n.groupIdx;if(i!==void 0){let o=e.groups[i].order;Vt(o)&&n.folder&&([n.mtime,n.ctimeNewest,n.ctimeOldest]=kt(n.folder,r))}})},Ge=function(t,e){var s,a,u;let r=this.fileExplorer;t._mCache=(s=t.plugin)==null?void 0:s.app.metadataCache;let n=Ie((a=t==null?void 0:t.plugin)==null?void 0:a.app),i=Re((u=t==null?void 0:t.plugin)==null?void 0:u.app),o=(t.itemsToHide?this.file.children.filter(d=>!t.itemsToHide.has(d.name)):this.file.children).map(d=>Wt(d,t,{starredPluginInstance:n,iconFolderPluginInstance:i}));$t(o,t),o.sort(function(d,f){return Gt(d,f,t)});let l=o.map(d=>r.fileItems[d.path]);re.requireApiVersion&&(0,re.requireApiVersion)("0.15.0")?this.vChildren.setChildren(l):this.children=l,t._mCache=void 0,t.plugin=void 0};var Ve=" *([MDCLXVI]+)";var ke=" *([MDCLXVI]+(?:\\.[MDCLXVI]+)*)";var $e=" *([MDCLXVI]+(?:-[MDCLXVI]+)*)";var ze=" *(\\d+)";var He=" *(\\d+(?:\\.\\d+)*)";var Be=" *(\\d+(?:-\\d+)*)",se=".",ae="-";var Ue="|";function V(t,e){if(t.length<e){let r=e-t.length;return"000000000000000000000000000".substring(0,r)+t}else return t}function k(t="",e,r){return e?`${t.split(e).filter(i=>i).map(i=>V(i,r!=null?r:8)).join(Ue)}//`:`${V(t,r!=null?r:8)}//`}function oe(t){let e="0iIvVxXlLcCdDmM",r=[0,1,1,5,5,10,10,50,50,100,100,500,500,1e3,1e3];if(t){let n=e.indexOf(t[0]);return n>0?r[n]:0}else return 0}function We(t){if(t==null)return"0";let e=oe(t.charAt(0)),r,n;for(let i=1;i<t.length;i++)n=oe(t.charAt(i)),r=oe(t.charAt(i-1)),n<=r?e+=n:e=e-r*2+n;return`${e}`}function $(t,e,r){return e?`${t.split(e).filter(i=>i).map(i=>V(We(i),r!=null?r:8)).join(Ue)}//`:`${V(We(t),r!=null?r:8)}//`}var zt="/",z="...",je="*",B=`/${z}`,U=`/${z}/`,Z=`/${je}`,le=0,Ze=t=>t.split(zt).filter(e=>!!e),H=class{constructor(){this.tree={subtree:{}};this.determinedWildcardRules={};this.addWildcardDefinition=(e,r)=>{let n=Ze(e),i=n.pop();if(i!==je&&i!==z)return null;let o=this.tree;if(n.forEach(l=>{let s=o.subtree[l];if(s)o=s;else{let a={name:l,subtree:{}};o.subtree[l]=a,o=a}}),i===z){if(o.matchChildren)return{errorMsg:`Duplicate wildcard '${i}' specification for ${e}`};o.matchChildren=r}else{if(o.matchAll)return{errorMsg:`Duplicate wildcard '${i}' specification for ${e}`};o.matchAll=r}};this.addRegexpDefinition=(e,r,n,i,o)=>{let l={regexp:e,againstName:r,priority:n||le,sortingSpec:o,logMatches:!!i};if(this.regexps===void 0||this.regexps.length===0)this.regexps=[l];else{let s=0;for(;s<this.regexps.length&&this.regexps[s].priority>l.priority;)s++;this.regexps.splice(s,0,l)}};this.folderMatch=(e,r)=>{var i,o,l;let n=this.determinedWildcardRules[e];if(n)return(i=n.spec)!=null?i:null;{let s;if(this.regexps){for(let a of this.regexps)if(!(a.againstName&&!r)&&a.regexp.test(a.againstName?r||"":e)){if(s=a.sortingSpec,a.logMatches){let u=a.againstName?`name: ${r}`:`path: ${e}`;console.log(`custom-sort plugin - regexp <${a.regexp.source}> matched folder ${u}`)}break}}if(!s){s=this.tree.matchChildren;let a=this.tree.matchAll,u=Ze(e),d=this.tree,f=u.length-1;for(let m=0;m<=f;m++){let p=u[m],F=d.subtree[p];if(F)d=F,s=(o=F==null?void 0:F.matchChildren)!=null?o:null,a=(l=F.matchAll)!=null?l:a;else{m<f&&(s=a);break}}s=s!=null?s:a}return s?(this.determinedWildcardRules[e]={spec:s},s):(this.determinedWildcardRules[e]={},null)}}}};var lt=(c=>(c[c.SyntaxError=0]="SyntaxError",c[c.SyntaxErrorInGroupSpec=1]="SyntaxErrorInGroupSpec",c[c.DuplicateSortSpecForSameFolder=2]="DuplicateSortSpecForSameFolder",c[c.DuplicateOrderAttr=3]="DuplicateOrderAttr",c[c.DanglingOrderAttr=4]="DanglingOrderAttr",c[c.MissingAttributeValue=5]="MissingAttributeValue",c[c.NoSpaceBetweenAttributeAndValue=6]="NoSpaceBetweenAttributeAndValue",c[c.InvalidAttributeValue=7]="InvalidAttributeValue",c[c.TargetFolderNestedSpec=8]="TargetFolderNestedSpec",c[c.TooManyNumericSortingSymbols=9]="TooManyNumericSortingSymbols",c[c.NumericalSymbolAdjacentToWildcard=10]="NumericalSymbolAdjacentToWildcard",c[c.ItemToHideExactNameWithExtRequired=11]="ItemToHideExactNameWithExtRequired",c[c.ItemToHideNoSupportForThreeDots=12]="ItemToHideNoSupportForThreeDots",c[c.DuplicateWildcardSortSpecForSameFolder=13]="DuplicateWildcardSortSpecForSameFolder",c[c.StandardObsidianSortAllowedOnlyAtFolderLevel=14]="StandardObsidianSortAllowedOnlyAtFolderLevel",c[c.PriorityNotAllowedOnOutsidersGroup=15]="PriorityNotAllowedOnOutsidersGroup",c[c.TooManyPriorityPrefixes=16]="TooManyPriorityPrefixes",c[c.CombiningNotAllowedOnOutsidersGroup=17]="CombiningNotAllowedOnOutsidersGroup",c[c.TooManyCombinePrefixes=18]="TooManyCombinePrefixes",c[c.ModifierPrefixesOnlyOnOutsidersGroup=19]="ModifierPrefixesOnlyOnOutsidersGroup",c[c.OnlyLastCombinedGroupCanSpecifyOrder=20]="OnlyLastCombinedGroupCanSpecifyOrder",c[c.TooManyGroupTypePrefixes=21]="TooManyGroupTypePrefixes",c[c.PriorityPrefixAfterGroupTypePrefix=22]="PriorityPrefixAfterGroupTypePrefix",c[c.CombinePrefixAfterGroupTypePrefix=23]="CombinePrefixAfterGroupTypePrefix",c[c.InlineRegexInPrefixAndSuffix=24]="InlineRegexInPrefixAndSuffix",c[c.DuplicateByNameSortSpecForFolder=25]="DuplicateByNameSortSpecForFolder",c[c.EmptyFolderNameToMatch=26]="EmptyFolderNameToMatch",c[c.InvalidOrEmptyFolderMatchingRegexp=27]="InvalidOrEmptyFolderMatchingRegexp",c))(lt||{}),Ht=new Set([2,13,20,25,26,27]),C="...",de=C.length,Bt=1,Ut={"a-z":{asc:1,desc:3},"true a-z":{asc:2,desc:4},created:{asc:9,desc:11},modified:{asc:5,desc:7},"advanced modified":{asc:6,desc:8},"advanced created":{asc:10,desc:12},"a-z, created":{asc:1,desc:3,secondary:9},"a-z, created desc":{asc:1,desc:3,secondary:11},"a-z, modified":{asc:1,desc:3,secondary:5},"a-z, modified desc":{asc:1,desc:3,secondary:7},"a-z, advanced created":{asc:1,desc:3,secondary:10},"a-z, advanced created desc":{asc:1,desc:3,secondary:12},"a-z, advanced modified":{asc:1,desc:3,secondary:6},"a-z, advanced modified desc":{asc:1,desc:3,secondary:8}},Xe="by-metadata:";var fe="target-folder:",qe={[fe]:1,"order-asc:":2,"order-desc:":3,"sorting:":4,"::::":1,"<":2,"\\<":2,">":3,"\\>":3},Ye=".",Zt="/:files",jt="/:",Xt="/:files.",qt="/:.",Yt="/folders",Kt="/",Jt="%",Qt="/folders:files",er="/%",tr="--%",rr="/--hide:",Ke="with-metadata:",ir="starred:",Je="with-icon:",nr="//",or="/!",sr="/!!",ar="/!!!",lr="/!:",dr="/!!:",ur="/!!!:",dt=1,ut=2,ct=3,Qe={[or]:dt,[sr]:ut,[ar]:ct},et={[lr]:dt,[dr]:ut,[ur]:ct},cr="/+",gr=[cr],tt={[jt]:{filesOnly:!0},[Zt]:{filesOnly:!0},[qt]:{filesOnly:!0,filenameWithExt:!0},[Xt]:{filesOnly:!0,filenameWithExt:!0},[Kt]:{foldersOnly:!0},[Yt]:{foldersOnly:!0},[Jt]:{},[Qt]:{},[er]:{},[tr]:{itemToHide:!0},[rr]:{itemToHide:!0}},O=t=>t===C,N=t=>t.indexOf(C)!==-1,gt="\\R+",ft="\\.R+",pt="\\-R+",mt="\\d+",ht="\\.d+",xt="\\-d+",St="\\d",bt="\\[0-9]",Ft="\\[0-3]",fr=/[\^$.\-+\[\]{}()|*?=!\\]/g,I=t=>t.replace(fr,"\\$&"),pr=[I(mt),I(gt),I(ht),I(xt),I(ft),I(pt)],R=new RegExp(pr.join("|"),"gi"),mr=[I(St),I(bt),I(Ft)],rt={[St]:"\\d",[bt]:"[0-9]",[Ft]:"[0-3]"},it=new RegExp(mr.join("|"),"gi"),hr=t=>(R.lastIndex=0,R.test(t)&&R.test(t)),xr=t=>(R.lastIndex=0,R.test(t)),Sr=t=>(it.lastIndex=0,t?it.test(t):!1),br=t=>{if(t){R.lastIndex=0;let e=R.exec(t);return e?e[0]:null}else return null},Fr=t=>$(t),yr=t=>$(t,se),Cr=t=>$(t,ae),Ir=t=>k(t),Or=t=>k(t,se),Ar=t=>k(t,ae);var Tr={[gt.toLowerCase()]:{regexpStr:Ve,normalizerFn:Fr,advancedRegexType:4},[ft.toLowerCase()]:{regexpStr:ke,normalizerFn:yr,advancedRegexType:5},[pt.toLowerCase()]:{regexpStr:$e,normalizerFn:Cr,advancedRegexType:6},[mt.toLowerCase()]:{regexpStr:ze,normalizerFn:Ir,advancedRegexType:1},[ht.toLowerCase()]:{regexpStr:He,normalizerFn:Or,advancedRegexType:2},[xt.toLowerCase()]:{regexpStr:Be,normalizerFn:Ar,advancedRegexType:3}};var nt=t=>pe(t,1),ot=t=>pe(t,2),Rr=t=>pe(t,3),pe=(t,e)=>{let r=[1,3].includes(e),n=[2,3].includes(e),i=br(t);if(i){let o=Tr[i.toLowerCase()],[l,s]=t.split(i),a=r?"^":"",u=n?"$":"",d=ue(l),f=ue(s);return{regexpSpec:{regex:new RegExp(`${a}${d}${o.regexpStr}${f}${u}`,"i"),normalizerFn:o.normalizerFn},prefix:l,suffix:s,containsAdvancedRegex:o.advancedRegexType}}else if(Sr(t)){let o=ue(t),l=r?"^":"",s=n?"$":"";return{regexpSpec:{regex:new RegExp(`${l}${o}${s}`,"i")},prefix:"",suffix:"",containsAdvancedRegex:0}}else return null},ue=t=>{if(t==="")return t;let e=[];for(;t.length>0;){let r,n;for(let i of Object.keys(rt)){let o=t.indexOf(i);o>=0&&(r!==void 0?o<r&&(r=o,n=i):(r=o,n=i))}if(r!==void 0){if(r>0){let i=t.substring(0,r);e.push(I(i)),t=t.substring(r)}e.push(rt[n]),t=t.substring(n.length)}else e.push(I(t)),t=""}return e.join("")},_="name:",ce="regexp:",Er="for-name:",Pr="debug:",Nr=t=>(t=t!=null?t:{},t.sortSpecByPath||(t.sortSpecByPath={}),t),Mr=t=>(t=t!=null?t:{},t.sortSpecByName||(t.sortSpecByName={}),t),st=t=>(t=t!=null?t:{},t.sortSpecByWildcard||(t.sortSpecByWildcard=new H),t),j=t=>({noPrefix:t.prefix.length===0,noSuffix:t.suffix.length===0}),Lr=t=>t.endsWith(B)||t.endsWith(U)||t.endsWith(Z);var vr=t=>t.endsWith(Z)?(t=t.slice(0,-Z.length),{path:t.length>0?t:"/",detectedWildcardPriority:3}):t.endsWith(B)?(t=t.slice(0,-B.length),{path:t.length>0?t:"/",detectedWildcardPriority:2}):t.endsWith(U)?(t=t.slice(0,-U.length),{path:t.length>0?t:"/",detectedWildcardPriority:2}):{path:t,detectedWildcardPriority:1},ge=(t,e,r)=>t.startsWith(e)?(r(),t.substring(e.length).trim()):t,Dr=t=>{let e=!1,r,n,i;do{i=!1,t=ge(t,Er,()=>{e=!0,i=!0});for(let o of Object.keys(et)){let l=!1;if(t=ge(t,o,()=>{r=et[o],i=!0,l=!0}),l)break}t=ge(t,Pr,()=>{n=!0,i=!0})}while(i);if(!t||t.trim()==="")throw new Error("Empty regexp");return{regexp:new RegExp(t),againstName:e,priority:r===void 0?le:r,log:!!n}},at=(t,e)=>{var n,i;let r=(i=(n=t.trim().split(" "))==null?void 0:n[0])==null?void 0:i.trim();return r||e},X="Numerical sorting symbol must not be directly adjacent to a wildcard because of potential performance problem. An additional explicit separator helps in such case.",q=class{constructor(e){this.errorLogger=e;this.pathMatchPriorityForPath={};this.problem=(e,r)=>{var s;let n=lt[e],i=(s=this.errorLogger)!=null?s:console.error,o=!Ht.has(e),l=o?` line ${this.currentEntryLineIdx} of`:"";i(`Sorting specification problem: ${e}:${n} ${r} ---encountered in${l} sorting spec in file ${this.currentSortingSpecContainerFilePath}`),l&&i(`Content of problematic line: "${this.currentEntryLine}"`),this.recentErrorMessage=`File: ${this.currentSortingSpecContainerFilePath}
`+(o?`Specification line #${this.currentEntryLineIdx}: "${this.currentEntryLine}"
`:"")+`Problem: ${e}:${n}
Details: ${r}`,this.problemAlreadyReportedForCurrentLine=!0};this.parseAttribute=e=>{let r=e.trimStart(),n=e.length-r.length,i=r.indexOf(" ");if(i===-1)return null;let o=r.substring(0,i),l=o.toLowerCase(),s=qe[l];if(s){let a=r.substring(i).trim();if(a){let u=this.attrValueValidators[s];if(u){let d=u(a);if(d)return{nesting:n,attribute:s,value:d};this.problem(7,`Invalid value of the attribute "${o}"`)}else return{nesting:n,attribute:s,value:a}}else this.problem(5,`Attribute "${o}" requires a value to follow`)}return null};this.checkForRiskyAttrSyntaxError=e=>{let r=e.trimStart(),n=r.toLowerCase();for(let i of Object.keys(qe))if(n.startsWith(i)){let o=r.substring(0,i.length);return n.length===i.length?(this.problem(5,`Attribute "${o}" requires a value to follow`),!0):(this.problem(6,`Space required after attribute name "${o}"`),!0)}return!1};this.parseSortingGroupSpec=e=>{let r=e.trim();if(hr(r))return this.problem(9,"Maximum one numeric sorting indicator allowed per line"),null;if(N(r)){let[m,p]=r.split(C);if(N(m)&&N(p))return this.problem(24,"In current version, inline regex symbols are not allowed both in prefix and suffix."),null}let n,i=0,o,l=0,s,a=0,u=!1,d=!1,f;for(;f===void 0||f;){let m=!1;for(let p of Object.keys(Qe))if(r===p||r.startsWith(p+" ")){n=Qe[p],i++,f=!0,m=!0,s&&(u=!0),r=r.substring(p.length).trim();break}if(!m){for(let p of gr)if(r===p||r.startsWith(p+" ")){o=!0,l++,f=!0,m=!0,s&&(d=!0),r=r.substring(p.length).trim();break}if(!m){for(let p of Object.keys(tt))if(r===p||r.startsWith(p+" ")){s=tt[p],a++,f=!0,m=!0,r=r.substring(p.length).trim();break}m||(f=!1)}}}return i>1?(this.problem(16,"Only one priority prefix allowed on sorting group"),null):r===""&&n?(this.problem(15,"Priority is not allowed for sorting group with empty match-pattern"),null):l>1?(this.problem(18,"Only one combining prefix allowed on sorting group"),null):r===""&&o?(this.problem(17,"Combining is not allowed for sorting group with empty match-pattern"),null):a>1?(this.problem(21,"Only one sorting group type prefix allowed on sorting group"),null):u?(this.problem(22,"Priority prefix must be used before sorting group type indicator"),null):d?(this.problem(23,"Combining prefix must be used before sorting group type indicator"),null):r===""&&s?s.itemToHide?(this.problem(11,"Exact name with ext of file or folders to hide is required"),null):{outsidersGroup:!0,filesOnly:s.filesOnly,foldersOnly:s.foldersOnly}:s?s.itemToHide?{itemToHide:!0,plainSpec:r,filesOnly:s.filesOnly,foldersOnly:s.foldersOnly}:{plainSpec:r,filesOnly:s.filesOnly,foldersOnly:s.foldersOnly,matchFilenameWithExt:s.filenameWithExt,priority:n!=null?n:void 0,combine:o}:(n||o)&&r!==""?{plainSpec:r,priority:n,combine:o}:null};this.COMBINING_INDICATOR_IDX=-1;this.validateTargetFolderAttrValue=e=>{if(e){let r=e.trim();return r||null}else return null};this.internalValidateOrderAttrValue=e=>{var l,s;e=e.trim();let r=e,n={},i=!1;if(e.indexOf(Xe)>0){let a=e.split(Xe);r=(l=a[0])==null?void 0:l.trim();let u=(s=a[1])==null?void 0:s.trim();u&&(n.applyToMetadataField=u),i=!0}let o=r?Ut[r.toLowerCase()]:null;if(o)if(i&&(o.asc===1||o.desc===3||o.asc===2||o.desc===4)){let a=o.asc===2||o.desc===4;o={...o,asc:a?14:13,desc:a?16:15}}else n.applyToMetadataField=void 0;return o?{...o,...n}:null};this.validateOrderAscAttrValue=e=>{let r=this.internalValidateOrderAttrValue(e);return r?{order:r.asc,secondaryOrder:r.secondary,applyToMetadataField:r.applyToMetadataField}:null};this.validateOrderDescAttrValue=e=>{let r=this.internalValidateOrderAttrValue(e);return r?{order:r.desc,secondaryOrder:r.secondary,applyToMetadataField:r.applyToMetadataField}:null};this.validateSortingAttrValue=e=>e.trim().toLowerCase()==="standard"?{order:17}:null;this.attrValueValidators={[1]:this.validateTargetFolderAttrValue.bind(this),[2]:this.validateOrderAscAttrValue.bind(this),[3]:this.validateOrderDescAttrValue.bind(this),[4]:this.validateSortingAttrValue.bind(this)};this.convertPlainStringSortingGroupSpecToArraySpec=e=>{if(e=e.trim(),O(e))return[C];if(e.startsWith(C))return[C,e.substring(de)];if(e.endsWith(C))return[e.substring(0,e.length-de),C];let r=e.indexOf(C);return r>0?[e.substring(0,r),C,e.substring(r+de)]:[e]};this.consumeParsedSortingGroupSpec=e=>{var r,n,i;if(e.outsidersGroup)return{type:0,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt};if(((r=e.arraySpec)==null?void 0:r.length)===1){let o=e.arraySpec[0];if(O(o))return{type:1,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt};if(o.startsWith(Ke)){let l=at(o.substring(Ke.length),G);return{type:6,withMetadataFieldName:l,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}}else if(o.startsWith(Je)){let l=at(o.substring(Je.length));return{type:8,iconName:l,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}}else return o.startsWith(ir)?{type:7,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}:{type:2,exactText:o,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}}if(((n=e.arraySpec)==null?void 0:n.length)===2){let o=e.arraySpec[0],l=e.arraySpec[1];return O(o)&&!O(l)&&!N(l)?{type:4,exactSuffix:l,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}:!O(o)&&O(l)&&!N(o)?{type:3,exactPrefix:o,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}:(this.problem(1,"three dots occurring more than once and no more text specified"),null)}if(((i=e.arraySpec)==null?void 0:i.length)===3){let o=e.arraySpec[0],l=e.arraySpec[1],s=e.arraySpec[2];return O(l)&&!O(o)&&!O(s)&&!N(s)?{type:5,exactPrefix:o,exactSuffix:s,filesOnly:e.filesOnly,foldersOnly:e.foldersOnly,matchFilenameWithExt:e.matchFilenameWithExt}:(this.problem(1,"three dots occurring more than once or unrecognized specification of sorting rule"),null)}return this.problem(1,"Unrecognized specification of sorting rule"),null};this.adjustSortingGroupForRegexBasedMatchers=e=>this.adjustSortingGroupForNumericSortingSymbol(e);this.adjustSortingGroupForNumericSortingSymbol=e=>{switch(e.type){case 3:let r=nt(e.exactPrefix);if(r){if(r.containsAdvancedRegex&&j(r).noSuffix)return this.problem(10,X),!1;delete e.exactPrefix,e.regexPrefix=r.regexpSpec}break;case 4:let n=ot(e.exactSuffix);if(n){if(n.containsAdvancedRegex&&j(n).noPrefix)return this.problem(10,X),!1;delete e.exactSuffix,e.regexSuffix=n.regexpSpec}break;case 5:let i=nt(e.exactPrefix);if(i){if(i.containsAdvancedRegex&&j(i).noSuffix)return this.problem(10,X),!1;delete e.exactPrefix,e.regexPrefix=i.regexpSpec}let o=ot(e.exactSuffix);if(o){if(o.containsAdvancedRegex&&j(o).noPrefix)return this.problem(10,X),!1;delete e.exactSuffix,e.regexSuffix=o.regexpSpec}break;case 2:let l=Rr(e.exactText);l&&(delete e.exactText,e.regexPrefix=l.regexpSpec);break}return!0};this.addExpediteGroupInfo=(e,r,n)=>{e.priorityOrder||(e.priorityOrder=[]);let i=!1;for(let o=0;o<e.priorityOrder.length;o++)if(r>e.groups[e.priorityOrder[o]].priority){e.priorityOrder.splice(o,0,n),i=!0;break}i||e.priorityOrder.push(n)}}parseSortSpecFromText(e,r,n,i){this.ctx={folderPath:r,specs:[]},this.currentEntryLine=null,this.currentEntryLineIdx=null,this.currentSortingSpecContainerFilePath=null,this.problemAlreadyReportedForCurrentLine=null,this.recentErrorMessage=null;let o=!1,l=0;for(let s of e){l++,this.currentEntryLine=s,this.currentEntryLineIdx=l,this.currentSortingSpecContainerFilePath=`${r==="/"?"":r}/${n}`,this.problemAlreadyReportedForCurrentLine=!1;let a=s.trim();if(a===""||a.startsWith(nr))continue;o=!1;let u=this.parseAttribute(s);if(u)o=this.processParsedSortingAttribute(u),this.ctx.previousValidEntryWasTargetFolderAttr=o&&u.attribute===1;else if(!this.problemAlreadyReportedForCurrentLine&&!this.checkForRiskyAttrSyntaxError(s)){let d=this.parseSortingGroupSpec(s);!this.problemAlreadyReportedForCurrentLine&&!d&&(d={plainSpec:a}),d&&(o=this.processParsedSortGroupSpec(d)),this.ctx.previousValidEntryWasTargetFolderAttr=void 0}if(!o){this.problemAlreadyReportedForCurrentLine||this.problem(0,"Sorting specification line doesn't match any supported syntax");break}}if(o){if(this.ctx.specs.length>0){for(let s of this.ctx.specs)if(!this.postprocessSortSpec(s))return null;for(let s of this.ctx.specs)for(let a=0;a<s.targetFoldersPaths.length;a++){let u=s.targetFoldersPaths[a];if(u.startsWith(_)){let d=u.substring(_.length).trim();if(d==="")return this.problem(26,`Empty '${fe} ${_}' value`),null;if(i=Mr(i),i.sortSpecByName[d])return this.problem(25,`Duplicate '${fe} ${_}' definition for the same name <${d}>`),null;i.sortSpecByName[d]=s}}for(let s of this.ctx.specs)for(let a=0;a<s.targetFoldersPaths.length;a++){let u=s.targetFoldersPaths[a];if(u.startsWith(ce)){i=st(i);let d=u.substring(ce.length).trim();try{let f=Dr(d);i.sortSpecByWildcard.addRegexpDefinition(f.regexp,f.againstName,f.priority,f.log,s)}catch(f){return this.problem(27,`Invalid or empty folder regexp expression <${d}>`),null}}else if(Lr(u)){i=st(i);let d=i.sortSpecByWildcard.addWildcardDefinition(u,s);if(d!=null&&d.errorMsg)return this.problem(13,d==null?void 0:d.errorMsg),null}}for(let s of this.ctx.specs)for(let a=0;a<s.targetFoldersPaths.length;a++){let u=s.targetFoldersPaths[a];if(!u.startsWith(_)&&!u.startsWith(ce)){let{path:d,detectedWildcardPriority:f}=vr(u),m=!0,p=this.pathMatchPriorityForPath[d];if(p){if(p===1&&f===1)return this.problem(2,`Duplicate sorting spec for folder ${d}`),null;f>=p&&(m=!1)}m&&(i=Nr(i),i.sortSpecByPath[d]=s,this.pathMatchPriorityForPath[d]=f)}}}return i}else return null}processParsedSortingAttribute(e){if(e.attribute===1)return e.nesting===0?(this.ctx.previousValidEntryWasTargetFolderAttr?this.ctx.currentSpec?this.ctx.currentSpec.targetFoldersPaths.push(e.value):this.ctx.currentSpec=this.putNewSpecForNewTargetFolder(e.value):this.ctx.currentSpec=this.putNewSpecForNewTargetFolder(e.value),!0):(this.problem(8,"Nested (indented) specification of target folder is not allowed"),!1);if(e.attribute===2||e.attribute===3||e.attribute===4){if(e.nesting===0){if(this.ctx.currentSpec||(this.ctx.currentSpec=this.putNewSpecForNewTargetFolder()),this.ctx.currentSpec.defaultOrder){let r=this.ctx.currentSpec.targetFoldersPaths.join(" :: ");return this.problem(3,`Duplicate order specification for folder(s) ${r}`),!1}return this.ctx.currentSpec.defaultOrder=e.value.order,this.ctx.currentSpec.byMetadataField=e.value.applyToMetadataField,!0}else if(e.nesting>0){if(!this.ctx.currentSpec||!this.ctx.currentSpecGroup)return this.problem(4,"Nested (indented) attribute requires prior sorting group definition"),!1;if(this.ctx.currentSpecGroup.order){let r=this.ctx.currentSpec.targetFoldersPaths.join(" :: ");return this.problem(3,`Duplicate order specification for a sorting rule of folder ${r}`),!1}return e.value.order===17?(this.problem(14,"The standard Obsidian sort order is only allowed at a folder level (not nested syntax)"),!1):(this.ctx.currentSpecGroup.order=e.value.order,this.ctx.currentSpecGroup.byMetadataField=e.value.applyToMetadataField,this.ctx.currentSpecGroup.secondaryOrder=e.value.secondaryOrder,!0)}}return!1}processParsedSortGroupSpec(e){if(this.ctx.currentSpec||(this.ctx.currentSpec=this.putNewSpecForNewTargetFolder()),e.plainSpec&&(e.arraySpec=this.convertPlainStringSortingGroupSpecToArraySpec(e.plainSpec),delete e.plainSpec),e.itemToHide)return this.consumeParsedItemToHide(e)?!0:(this.problem(12,"For hiding of file or folder, the exact name with ext is required and no numeric sorting indicator allowed"),!1);{let r=this.consumeParsedSortingGroupSpec(e);if(r)if(this.adjustSortingGroupForNumericSortingSymbol(r))if(this.ctx.currentSpec){let n=this.ctx.currentSpec.groups.push(r)-1;return this.ctx.currentSpecGroup=r,e.priority&&e.priority>0&&(r.priority=e.priority,this.addExpediteGroupInfo(this.ctx.currentSpec,e.priority,n)),e.combine&&(r.combineWithIdx=this.COMBINING_INDICATOR_IDX),!0}else return!1;else return!1;else return!1}}postprocessSortSpec(e){var s;e.outsidersGroupIdx=void 0,e.outsidersFilesGroupIdx=void 0,e.outsidersFoldersGroupIdx=void 0;let r,n;for(let a=0;a<e.groups.length;a++){let u=e.groups[a];u.type===0&&(u.filesOnly?y(e.outsidersFilesGroupIdx)?console.warn(`Ignoring duplicate Outsiders-files sorting group definition in sort spec for folder '${D(e.targetFoldersPaths)}'`):(e.outsidersFilesGroupIdx=a,n=!0):u.foldersOnly?y(e.outsidersFoldersGroupIdx)?console.warn(`Ignoring duplicate Outsiders-folders sorting group definition in sort spec for folder '${D(e.targetFoldersPaths)}'`):(e.outsidersFoldersGroupIdx=a,r=!0):y(e.outsidersGroupIdx)?console.warn(`Ignoring duplicate Outsiders sorting group definition in sort spec for folder '${D(e.targetFoldersPaths)}'`):(e.outsidersGroupIdx=a,r=!0,n=!0))}y(e.outsidersGroupIdx)&&(y(e.outsidersFilesGroupIdx)||y(e.outsidersFoldersGroupIdx))&&console.warn(`Inconsistent Outsiders sorting group definition in sort spec for folder '${D(e.targetFoldersPaths)}'`),n&&r||(e.outsidersGroupIdx=e.groups.length,e.groups.push({type:0}));let i=!1,o;for(let a=0;a<e.groups.length;a++){let u=e.groups[a];if(u.combineWithIdx===this.COMBINING_INDICATOR_IDX){if(o===void 0)o=a;else if(e.groups[a-1].order)return this.problem(20,"Predecessor group of combined group cannot contain order specification. Put it at the last of group in combined groups"),!1;u.combineWithIdx=o,i=!0}else o=void 0}if(i){let a,u,d;for(let f=e.groups.length-1;f>=0;f--){let m=e.groups[f];m.combineWithIdx!==void 0?m.combineWithIdx===d?(m.order=a,m.byMetadataField=u):(d=m.combineWithIdx,a=m.order,u=m.byMetadataField):(d=void 0,a=void 0,u=void 0)}}for(let a of e.groups)a.order||(a.order=(s=e.defaultOrder)!=null?s:Bt,a.byMetadataField=e.byMetadataField);if(e.priorityOrder)for(let a=0;a<e.groups.length;a++){let u=e.groups[a];u.priority===void 0&&u.type!==0&&e.priorityOrder.push(a)}let l=`${Ye}/`;return e.targetFoldersPaths.forEach((a,u)=>{a===Ye?e.targetFoldersPaths[u]=this.ctx.folderPath:a.startsWith(l)&&(e.targetFoldersPaths[u]=`${this.ctx.folderPath}/${a.substring(l.length)}`)}),!0}putNewSpecForNewTargetFolder(e){let r={targetFoldersPaths:[e!=null?e:this.ctx.folderPath],groups:[]};return this.ctx.specs.push(r),this.ctx.currentSpec=void 0,this.ctx.currentSpecGroup=void 0,r}consumeParsedItemToHide(e){var r,n,i;if(((r=e.arraySpec)==null?void 0:r.length)===1){let o=e.arraySpec[0];if(!O(o)){let l=o.trim();if(l&&!xr(l)&&this.ctx.currentSpec){let s=(i=(n=this.ctx.currentSpec)==null?void 0:n.itemsToHide)!=null?i:new Set;return s.add(l),this.ctx.currentSpec.itemsToHide=s,!0}}}return!1}};var E=require("obsidian"),M="custom-sort-icon-active",me="custom-sort-icon-mobile-initial",Y="custom-sort-icon-suspended",w="custom-sort-icon-enabled-not-applied",K="custom-sort-icon-syntax-error",he="custom-sort-icon-general-error";function yt(){(0,E.addIcon)(M,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" fill="currentColor"/>  
<path d="M 11.096126 32.678017 L 20.217128 18.949499 C 21.134003 17.56946 22.99602 17.193992 24.376058 18.110867 C 24.708624 18.331818 24.99374 18.616933 25.21469 18.949499 L 34.33569 32.678017 C 35.252567 34.058055 34.8771 35.92007 33.49706 36.836947 C 33.005085 37.163807 32.42757 37.338166 31.83691 37.338166 L 13.594907 37.338166 C 11.938053 37.338166 10.594907 35.99502 10.594907 34.338166 C 10.594907 33.747508 10.769266 33.16999 11.096126 32.678017 Z" fill="currentColor"/>  
<path d="M 11.096126 55.71973 L 20.217128 41.991214 C 21.134003 40.611175 22.99602 40.235707 24.376058 41.15258 C 24.708624 41.373533 24.99374 41.65865 25.21469 41.991214 L 34.33569 55.71973 C 35.252567 57.09977 34.8771 58.96179 33.49706 59.87866 C 33.005085 60.20552 32.42757 60.37988 31.83691 60.37988 L 13.594907 60.37988 C 11.938053 60.37988 10.594907 59.036736 10.594907 57.37988 C 10.594907 56.78922 10.769266 56.21171 11.096126 55.71973 Z" fill="currentColor"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" fill="currentColor"/>  
<path d="M 88.33569 46.24901 L 79.21469 59.97753 C 78.297815 61.35757 76.4358 61.73304 75.05576 60.81616 C 74.72319 60.59521 74.43808 60.310096 74.21713 59.97753 L 65.09613 46.24901 C 64.17925 44.868973 64.55472 43.006957 65.93476 42.09008 C 66.42673 41.76322 67.00425 41.588863 67.59491 41.588863 L 85.83691 41.588863 C 87.49377 41.588863 88.83691 42.93201 88.83691 44.58886 C 88.83691 45.17952 88.66255 45.757036 88.33569 46.24901 Z" fill="currentColor"/>  
<path d="M 88.33569 77.48964 L 79.21469 91.21816 C 78.297815 92.5982 76.4358 92.97366 75.05576 92.05679 C 74.72319 91.83584 74.43808 91.55072 74.21713 91.21816 L 65.09613 77.48964 C 64.17925 76.1096 64.55472 74.247585 65.93476 73.33071 C 66.42673 73.00385 67.00425 72.82949 67.59491 72.82949 L 85.83691 72.82949 C 87.49377 72.82949 88.83691 74.17264 88.83691 75.82949 C 88.83691 76.42015 88.66255 76.99766 88.33569 77.48964 Z"  fill="currentColor"/>`),(0,E.addIcon)(me,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" fill="currentColor"/>  
<path d="M 11.096126 55.71973 L 20.217128 41.991214 C 21.134003 40.611175 22.99602 40.235707 24.376058 41.15258 C 24.708624 41.373533 24.99374 41.65865 25.21469 41.991214 L 34.33569 55.71973 C 35.252567 57.09977 34.8771 58.96179 33.49706 59.87866 C 33.005085 60.20552 32.42757 60.37988 31.83691 60.37988 L 13.594907 60.37988 C 11.938053 60.37988 10.594907 59.036736 10.594907 57.37988 C 10.594907 56.78922 10.769266 56.21171 11.096126 55.71973 Z" fill="currentColor"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" fill="currentColor"/>  
<path d="M 88.33569 77.48964 L 79.21469 91.21816 C 78.297815 92.5982 76.4358 92.97366 75.05576 92.05679 C 74.72319 91.83584 74.43808 91.55072 74.21713 91.21816 L 65.09613 77.48964 C 64.17925 76.1096 64.55472 74.247585 65.93476 73.33071 C 66.42673 73.00385 67.00425 72.82949 67.59491 72.82949 L 85.83691 72.82949 C 87.49377 72.82949 88.83691 74.17264 88.83691 75.82949 C 88.83691 76.42015 88.66255 76.99766 88.33569 77.48964 Z"  fill="currentColor"/>`),(0,E.addIcon)(Y,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" stroke="currentColor" stroke-width="2" fill="none"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" stroke="currentColor" stroke-width="2" fill="none"/>`),(0,E.addIcon)(K,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" fill="red"/>  
<path d="M 11.096126 32.678017 L 20.217128 18.949499 C 21.134003 17.56946 22.99602 17.193992 24.376058 18.110867 C 24.708624 18.331818 24.99374 18.616933 25.21469 18.949499 L 34.33569 32.678017 C 35.252567 34.058055 34.8771 35.92007 33.49706 36.836947 C 33.005085 37.163807 32.42757 37.338166 31.83691 37.338166 L 13.594907 37.338166 C 11.938053 37.338166 10.594907 35.99502 10.594907 34.338166 C 10.594907 33.747508 10.769266 33.16999 11.096126 32.678017 Z" stroke="red" stroke-width="2" fill="none"/>  
<path d="M 11.096126 55.71973 L 20.217128 41.991214 C 21.134003 40.611175 22.99602 40.235707 24.376058 41.15258 C 24.708624 41.373533 24.99374 41.65865 25.21469 41.991214 L 34.33569 55.71973 C 35.252567 57.09977 34.8771 58.96179 33.49706 59.87866 C 33.005085 60.20552 32.42757 60.37988 31.83691 60.37988 L 13.594907 60.37988 C 11.938053 60.37988 10.594907 59.036736 10.594907 57.37988 C 10.594907 56.78922 10.769266 56.21171 11.096126 55.71973 Z" stroke="red" stroke-width="2" fill="none"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" stroke="red" stroke-width="2" fill="none"/>  
<path d="M 88.33569 46.24901 L 79.21469 59.97753 C 78.297815 61.35757 76.4358 61.73304 75.05576 60.81616 C 74.72319 60.59521 74.43808 60.310096 74.21713 59.97753 L 65.09613 46.24901 C 64.17925 44.868973 64.55472 43.006957 65.93476 42.09008 C 66.42673 41.76322 67.00425 41.588863 67.59491 41.588863 L 85.83691 41.588863 C 87.49377 41.588863 88.83691 42.93201 88.83691 44.58886 C 88.83691 45.17952 88.66255 45.757036 88.33569 46.24901 Z" fill="red"/>  
<path d="M 88.33569 77.48964 L 79.21469 91.21816 C 78.297815 92.5982 76.4358 92.97366 75.05576 92.05679 C 74.72319 91.83584 74.43808 91.55072 74.21713 91.21816 L 65.09613 77.48964 C 64.17925 76.1096 64.55472 74.247585 65.93476 73.33071 C 66.42673 73.00385 67.00425 72.82949 67.59491 72.82949 L 85.83691 72.82949 C 87.49377 72.82949 88.83691 74.17264 88.83691 75.82949 C 88.83691 76.42015 88.66255 76.99766 88.33569 77.48964 Z" fill="red"/>`),(0,E.addIcon)(he,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" fill="red"/>  
<path d="M 11.096126 32.678017 L 20.217128 18.949499 C 21.134003 17.56946 22.99602 17.193992 24.376058 18.110867 C 24.708624 18.331818 24.99374 18.616933 25.21469 18.949499 L 34.33569 32.678017 C 35.252567 34.058055 34.8771 35.92007 33.49706 36.836947 C 33.005085 37.163807 32.42757 37.338166 31.83691 37.338166 L 13.594907 37.338166 C 11.938053 37.338166 10.594907 35.99502 10.594907 34.338166 C 10.594907 33.747508 10.769266 33.16999 11.096126 32.678017 Z" fill="red"/>  
<path d="M 11.096126 55.71973 L 20.217128 41.991214 C 21.134003 40.611175 22.99602 40.235707 24.376058 41.15258 C 24.708624 41.373533 24.99374 41.65865 25.21469 41.991214 L 34.33569 55.71973 C 35.252567 57.09977 34.8771 58.96179 33.49706 59.87866 C 33.005085 60.20552 32.42757 60.37988 31.83691 60.37988 L 13.594907 60.37988 C 11.938053 60.37988 10.594907 59.036736 10.594907 57.37988 C 10.594907 56.78922 10.769266 56.21171 11.096126 55.71973 Z" fill="red"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" fill="red"/>  
<path d="M 88.33569 46.24901 L 79.21469 59.97753 C 78.297815 61.35757 76.4358 61.73304 75.05576 60.81616 C 74.72319 60.59521 74.43808 60.310096 74.21713 59.97753 L 65.09613 46.24901 C 64.17925 44.868973 64.55472 43.006957 65.93476 42.09008 C 66.42673 41.76322 67.00425 41.588863 67.59491 41.588863 L 85.83691 41.588863 C 87.49377 41.588863 88.83691 42.93201 88.83691 44.58886 C 88.83691 45.17952 88.66255 45.757036 88.33569 46.24901 Z" fill="red"/>  
<path d="M 88.33569 77.48964 L 79.21469 91.21816 C 78.297815 92.5982 76.4358 92.97366 75.05576 92.05679 C 74.72319 91.83584 74.43808 91.55072 74.21713 91.21816 L 65.09613 77.48964 C 64.17925 76.1096 64.55472 74.247585 65.93476 73.33071 C 66.42673 73.00385 67.00425 72.82949 67.59491 72.82949 L 85.83691 72.82949 C 87.49377 72.82949 88.83691 74.17264 88.83691 75.82949 C 88.83691 76.42015 88.66255 76.99766 88.33569 77.48964 Z" fill="red"/>`),(0,E.addIcon)(w,`<path d="M 93.54751 9.983795 L 79.21469 31.556912 C 78.297815 32.93695 76.4358 33.31242 75.05576 32.395544 C 74.72319 32.174593 74.43808 31.88948 74.21713 31.556912 L 59.8843 9.983795 C 58.96743 8.603756 59.3429 6.74174 60.722935 5.824865 C 61.21491 5.4980047 61.792426 5.3236456 62.383084 5.3236456 L 91.04873 5.3236456 C 92.70559 5.3236456 94.04873 6.666791 94.04873 8.323646 C 94.04873 8.914304 93.87437 9.49182 93.54751 9.983795 Z" stroke="orange" stroke-width="2" fill="none"/>  
<path d="M 11.096126 55.71973 L 20.217128 41.991214 C 21.134003 40.611175 22.99602 40.235707 24.376058 41.15258 C 24.708624 41.373533 24.99374 41.65865 25.21469 41.991214 L 34.33569 55.71973 C 35.252567 57.09977 34.8771 58.96179 33.49706 59.87866 C 33.005085 60.20552 32.42757 60.37988 31.83691 60.37988 L 13.594907 60.37988 C 11.938053 60.37988 10.594907 59.036736 10.594907 57.37988 C 10.594907 56.78922 10.769266 56.21171 11.096126 55.71973 Z" stroke="orange" stroke-width="2" fill="none"/>  
<path d="M 2.5382185 90.37054 L 20.217128 63.76105 C 21.134003 62.38101 22.99602 62.005545 24.376058 62.92242 C 24.708624 63.14337 24.99374 63.428486 25.21469 63.76105 L 42.8936 90.37054 C 43.810475 91.75058 43.435006 93.6126 42.05497 94.52947 C 41.562993 94.85633 40.985477 95.03069 40.39482 95.03069 L 5.0369993 95.03069 C 3.380145 95.03069 2.0369993 93.68755 2.0369993 92.03069 C 2.0369993 91.44004 2.2113584 90.86252 2.5382185 90.37054 Z" stroke="orange" stroke-width="2" fill="none"/>  
<path d="M 88.33569 46.24901 L 79.21469 59.97753 C 78.297815 61.35757 76.4358 61.73304 75.05576 60.81616 C 74.72319 60.59521 74.43808 60.310096 74.21713 59.97753 L 65.09613 46.24901 C 64.17925 44.868973 64.55472 43.006957 65.93476 42.09008 C 66.42673 41.76322 67.00425 41.588863 67.59491 41.588863 L 85.83691 41.588863 C 87.49377 41.588863 88.83691 42.93201 88.83691 44.58886 C 88.83691 45.17952 88.66255 45.757036 88.33569 46.24901 Z" stroke="orange" stroke-width="2" fill="none"/>`)}var _r={additionalSortspecFile:"",suspended:!0,statusBarEntryEnabled:!0,notificationsEnabled:!0,mobileNotificationsEnabled:!1},Ct="sortspec.md",It="sorting-spec",wr=1e4,J=class extends h.Plugin{showNotice(r,n){(this.settings.notificationsEnabled||h.Platform.isMobile&&this.settings.mobileNotificationsEnabled)&&new h.Notice(r,n)}readAndParseSortingSpec(){let r=this.app.metadataCache,n=!1,i=!1,o=null;this.sortSpecCache=null;let l=new q;h.Vault.recurseChildren(this.app.vault.getRoot(),s=>{var a,u,d;if(!n&&s instanceof h.TFile){let f=s,m=f.parent;if(f.name===Ct||f.name===`${Ct}.md`||f.basename===m.name||f.basename===this.settings.additionalSortspecFile||f.name===this.settings.additionalSortspecFile||f.path===this.settings.additionalSortspecFile||f.path===`${this.settings.additionalSortspecFile}.md`){let p=(u=(a=r.getCache(f.path))==null?void 0:a.frontmatter)==null?void 0:u[It];p&&(i=!0,this.sortSpecCache=l.parseSortSpecFromText(p.split(`
`),m.path,f.name,this.sortSpecCache),this.sortSpecCache===null&&(n=!0,o=(d=l.recentErrorMessage)!=null?d:""))}}}),this.sortSpecCache?this.showNotice("Parsing custom sorting specification SUCCEEDED!"):(i?o=o||`No valid '${It}:' key(s) in YAML front matter or multiline YAML indentation error or general YAML syntax error`:o="No custom sorting specification found or only empty specification(s)",this.showNotice(`Parsing custom sorting specification FAILED. Suspending the plugin.
${o}`,wr),this.settings.suspended=!0,this.saveSettings())}checkFileExplorerIsAvailableAndPatchable(r=!0){let n=this.getFileExplorer();if(n&&typeof n.createFolderDom=="function"&&typeof n.requestSort=="function")return n;r&&this.logWarningFileExplorerNotAvailable()}logWarningFileExplorerNotAvailable(){let r=`custom-sort v${this.manifest.version}: failed to locate File Explorer. The 'Files' core plugin can be disabled.
Some community plugins can also disable it.
See the example of MAKE.md plugin: https://github.com/Make-md/makemd/issues/25
You can find there instructions on how to re-enable the File Explorer in MAKE.md plugin`;console.warn(r)}switchPluginStateTo(r,n=!0){let i=this.checkFileExplorerIsAvailableAndPatchable();i&&!this.fileExplorerFolderPatched&&(this.fileExplorerFolderPatched=this.patchFileExplorerFolder(i),this.fileExplorerFolderPatched||(i=void 0)),this.settings.suspended=!r,this.saveSettings();let o;this.settings.suspended?(this.showNotice("Custom sort OFF"),this.sortSpecCache=null,o=Y):(this.readAndParseSortingSpec(),this.sortSpecCache?i?(this.showNotice("Custom sort ON"),this.initialAutoOrManualSortingTriggered=!0,o=M):(this.showNotice("Custom sort GENERAL PROBLEM. See console for detailed message."),o=he,this.settings.suspended=!0,this.saveSettings()):(o=K,this.settings.suspended=!0,this.saveSettings())),i?this.fileExplorerFolderPatched&&i.requestSort():o===M&&(o=w,n&&(this.ribbonIconStateInaccurate=!0)),n&&(0,h.setIcon)(this.ribbonIconEl,o),this.updateStatusBar()}async onload(){console.log(`loading custom-sort v${this.manifest.version}`),await this.loadSettings(),this.settings.statusBarEntryEnabled&&(this.statusBarItemEl=this.addStatusBarItem(),this.updateStatusBar()),yt(),this.ribbonIconEl=this.addRibbonIcon(h.Platform.isDesktop?this.settings.suspended?Y:w:me,"Toggle custom sorting",r=>{this.switchPluginStateTo(this.settings.suspended)}),this.settings.suspended||(this.ribbonIconStateInaccurate=!0),this.addSettingTab(new xe(this.app,this)),this.registerEventHandlers(),this.registerCommands(),this.initialize()}registerEventHandlers(){let r=this;this.registerEvent(this.app.metadataCache.on("resolved",()=>{if(!this.settings.suspended&&!this.initialAutoOrManualSortingTriggered)if(this.readAndParseSortingSpec(),this.initialAutoOrManualSortingTriggered=!0,this.sortSpecCache){this.showNotice("Custom sort ON");let n=this.checkFileExplorerIsAvailableAndPatchable(!1);n?((0,h.setIcon)(this.ribbonIconEl,M),n.requestSort()):((0,h.setIcon)(this.ribbonIconEl,w),r.ribbonIconStateInaccurate=!0),this.updateStatusBar()}else this.settings.suspended=!0,(0,h.setIcon)(this.ribbonIconEl,K),this.saveSettings()}))}registerCommands(){let r=this;this.addCommand({id:"enable-custom-sorting",name:"Enable and apply the custom sorting, (re)parsing the sorting configuration first. Sort-on.",callback:()=>{r.switchPluginStateTo(!0,!0)}}),this.addCommand({id:"suspend-custom-sorting",name:"Suspend the custom sorting. Sort-off.",callback:()=>{r.switchPluginStateTo(!1,!0)}})}initialize(){this.app.workspace.onLayoutReady(()=>{this.fileExplorerFolderPatched=this.patchFileExplorerFolder()})}patchFileExplorerFolder(r){let n=this;if(r=r!=null?r:this.checkFileExplorerIsAvailableAndPatchable(!1),r){let i=new h.TFolder(h.Vault,""),o=r.createFolderDom(i).constructor,l=Ce(o.prototype,{sort(s){return function(...a){var f,m,p,F,L,v;if(n.settings.suspended)return s.call(this,...a);n.ribbonIconStateInaccurate&&n.ribbonIconEl&&(n.ribbonIconStateInaccurate=!1,(0,h.setIcon)(n.ribbonIconEl,M));let u=this.file,d=(m=(f=n.sortSpecCache)==null?void 0:f.sortSpecByPath)==null?void 0:m[u.path];return d=d!=null?d:(F=(p=n.sortSpecCache)==null?void 0:p.sortSpecByName)==null?void 0:F[u.name],d?d.defaultOrder===17&&(d=null):(L=n.sortSpecCache)!=null&&L.sortSpecByWildcard&&(d=(v=n.sortSpecCache)==null?void 0:v.sortSpecByWildcard.folderMatch(u.path,u.name),(d==null?void 0:d.defaultOrder)===17&&(d=null)),d?(d.plugin=n,Ge.call(this,d,...a)):s.call(this,...a)}}});return this.register(l),!0}else return!1}getFileExplorer(){var n,i;return(i=(n=this.app.workspace.getLeavesOfType("file-explorer"))==null?void 0:n.first())==null?void 0:i.view}onunload(){}updateStatusBar(){this.statusBarItemEl&&this.statusBarItemEl.setText(`Custom sort:${this.settings.suspended?"OFF":"ON"}`)}async loadSettings(){this.settings=Object.assign({},_r,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},xe=class extends h.PluginSettingTab{constructor(r,n){super(r,n);this.plugin=n}display(){let{containerEl:r}=this;r.empty(),r.createEl("h2",{text:"Settings for Custom File Explorer Sorting Plugin"});let n=(0,h.sanitizeHTMLToDom)('A note name or note path to scan (YAML frontmatter) for sorting specification in addition to the `sortspec` notes and Folder Notes<sup><b>*</b></sup>.<br> The `.md` filename suffix is optional.<p><b>(*)</b>&nbsp;if you employ the <i>Index-File based</i> approach to folder notes (as documented in <a href="https://github.com/aidenlx/alx-folder-note/wiki/folder-note-pref">Aidenlx Folder Note preferences</a>) you can enter here the index note name, e.g. <b>_about_</b><br>The <i>Inside Folder, with Same Name Recommended</i> mode of Folder Notes is handled automatically, no additional configuration needed.</p><p>NOTE: After updating this setting remember to refresh the custom sorting via clicking on the ribbon icon or via the <b>sort-on</b> command or by restarting Obsidian or reloading the vault</p>');new h.Setting(r).setName("Path or name of additional note(s) containing sorting specification").setDesc(n).addText(i=>i.setPlaceholder("e.g. _about_").setValue(this.plugin.settings.additionalSortspecFile).onChange(async o=>{this.plugin.settings.additionalSortspecFile=o.trim()?(0,h.normalizePath)(o):"",await this.plugin.saveSettings()})),new h.Setting(r).setName("Enable the status bar entry").setDesc("The status bar entry shows the label `Custom sort:ON` or `Custom sort:OFF`, representing the current state of the plugin.").addToggle(i=>i.setValue(this.plugin.settings.statusBarEntryEnabled).onChange(async o=>{this.plugin.settings.statusBarEntryEnabled=o,o?(this.plugin.statusBarItemEl&&this.plugin.statusBarItemEl.detach(),this.plugin.statusBarItemEl=this.plugin.addStatusBarItem(),this.plugin.updateStatusBar()):this.plugin.statusBarItemEl&&this.plugin.statusBarItemEl.detach(),await this.plugin.saveSettings()})),new h.Setting(r).setName("Enable notifications of plugin state changes").setDesc("The plugin can show notifications about its state changes: e.g. when successfully parsed and applied the custom sorting specification, or, when the parsing failed. If the notifications are disabled, the only indicator of plugin state is the ribbon button icon. The developer console presents the parsing error messages regardless if the notifications are enabled or not.").addToggle(i=>i.setValue(this.plugin.settings.notificationsEnabled).onChange(async o=>{this.plugin.settings.notificationsEnabled=o,await this.plugin.saveSettings()})),new h.Setting(r).setName("Enable notifications of plugin state changes for mobile devices only").setDesc("See above.").addToggle(i=>i.setValue(this.plugin.settings.mobileNotificationsEnabled).onChange(async o=>{this.plugin.settings.mobileNotificationsEnabled=o,await this.plugin.saveSettings()}))}};
